## Install
- Deploy OVF into ESXi
- Set VM Network : OVF NICs

## Set IP
set interfaces ethernet eht0 address '10.0.0.1/24'
set interfaces ethernet eht0 address '15.210.188.100/22'

set service ssh port '22'
set system ntp server '16/110.135.123'

set protocols static route 0.0.0.0/0 next-hop 15.210.188.1 distance '1'

## NAT
set nat source rule 100 outbound-interface 'eth1'
set nat source rule 100 source address '10.0.0.0/16'
set nat source rule 100 translation address masquerade

## DNS
vyos@vyos# set service dns forwarding cache-size '0'
vyos@vyos# set service dns forwarding listen-on 'eth0'
vyos@vyos# set service dns forwarding name-server '15.227.128.52'
vyos@vyos# set service dns forwarding name-server '15.243.160.52'

## Transparent Proxy
### set environment properly as your environment

sudo mkdir /var/log/squid3
set service webproxy listen-address 10.0.255.254 #Add transparent proxy

```
vyos@vyos:~$ cat /etc/squid3/squid.conf
#
# autogenerated by vyatta-update-webproxy.pl
#

acl manager proto cache_object
acl localhost src 127.0.0.1/32
acl to_localhost dst 127.0.0.0/8
acl net src all
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

http_access allow manager localhost
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost
http_access allow net
http_access deny all

cache_dir ufs /var/spool/squid3 100 16 256
cache_mem 20 MB
access_log /var/log/squid3/access.log squid

cache_store_log none

http_port 10.0.255.254:3128 transparent

cache_peer 16.242.55.11 parent 8080 0 no-query #Add This line for 

forwarded_for off
```

vyos@vyos# set service webproxy cache-size '500'
[edit]
vyos@vyos# set service webproxy mem-cache-size '250'
[edit]
vyos@vyos# commit
[ service webproxy ]
mem-cache-size must be less than 50% of memory

[[service webproxy]] failed
Commit failed
[edit]
vyos@vyos# set service webproxy mem-cache-size '100'
[edit]
vyos@vyos# commit
[ service webproxy ]
Warning: webproxy may not work properly without a nameserver
Restarting Squid HTTP Proxy 3.x: squid3.

[edit]
vyos@vyos# save


## save
commit
save

